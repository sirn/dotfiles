---
## Install ntp
##

- name: install ntp via synth
  become: yes
  command: synth install net/ntp
  register: synth_ntp_install
  changed_when: synth_ntp_install.stdout.find("The most recent version of packages are already installed") == -1
  notify:
    - restart ntpd rc service


## Configure ntp
##

- name: enable ntpd in rc.conf
  become: yes
  lineinfile:
    dest: /etc/rc.conf
    line: ntpd_enable="YES"
    state: present
  register: ntpd_enabled

- name: set ntp time
  become: yes
  command: ntpd -qg
  when: ntpd_enabled.changed


## Enable ntp service
##

- name: enable ntpd
  become: yes
  service: name=ntpd enabled=yes state=started
