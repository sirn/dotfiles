#!/bin/sh
#
# Wrapper to use PostgreSQL client via Docker.
#
PATH=/usr/bin:/bin:/usr/local/bin

if command -v psql >/dev/null; then
    exec psql "$@"
fi

POSTGRESQL_IMAGE=${POSTGRESQL_IMAGE:-postgres:11-alpine}
DOCKER_CMD=
DOCKER_MOUNTS=

if command -v docker >/dev/null; then
    DOCKER_CMD=docker
fi

if command -v podman >/dev/null; then
    DOCKER_CMD=podman
fi

if [ -z "$DOCKER_CMD" ]; then
    printf >&2 "No psql client or Docker installed\\n"
    exit 1
fi

if [ -d /var/run/postgresql ]; then
    DOCKER_MOUNTS="-v /var/run/postgresql:/var/run/postgresql"
fi

# shellcheck disable=SC2086
exec "$DOCKER_CMD" run \
     --rm -it --net=host \
     $DOCKER_MOUNTS \
     "$POSTGRESQL_IMAGE" \
     psql "$@"
